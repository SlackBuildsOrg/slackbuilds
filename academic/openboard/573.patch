From 2aee390105b4d2e23f52df7bbd88247ce35109b6 Mon Sep 17 00:00:00 2001
From: letsfindaway <me@letsfindaway.de>
Date: Thu, 10 Mar 2022 18:07:02 +0100
Subject: [PATCH] fix: compile with poppler >= 22.03

- use c++17 (even required for poppler 22.01)
- handle API change
---
 src/pdf/XPDFRenderer.cpp | 2 ++
 src/pdf/pdf.pri          | 1 +
 2 files changed, 3 insertions(+)

diff --git a/src/pdf/XPDFRenderer.cpp b/src/pdf/XPDFRenderer.cpp
index a81616b82..568265651 100644
--- a/src/pdf/XPDFRenderer.cpp
+++ b/src/pdf/XPDFRenderer.cpp
@@ -95,6 +95,8 @@ XPDFRenderer::XPDFRenderer(const QString &filename, bool importingFile)
     }
 #ifdef USE_XPDF
     mDocument = new PDFDoc(new GString(filename.toLocal8Bit()), 0, 0, 0); // the filename GString is deleted on PDFDoc desctruction
+#elif POPPLER_VERSION_MAJOR > 22 || (POPPLER_VERSION_MAJOR == 22 && POPPLER_VERSION_MINOR >= 3)
+    mDocument = new PDFDoc(std::make_unique<GooString>(filename.toLocal8Bit()));
 #else
     mDocument = new PDFDoc(new GooString(filename.toLocal8Bit()), 0, 0, 0); // the filename GString is deleted on PDFDoc desctruction
 #endif
diff --git a/src/pdf/pdf.pri b/src/pdf/pdf.pri
index 9be1b7feb..aeb09b5bf 100644
--- a/src/pdf/pdf.pri
+++ b/src/pdf/pdf.pri
@@ -1,3 +1,4 @@
+CONFIG += c++17
 
 HEADERS      += src/pdf/GraphicsPDFItem.h \
                 src/pdf/PDFRenderer.h \
